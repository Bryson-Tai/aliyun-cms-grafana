{"version":3,"sources":["../src/datasource.js"],"names":["_","Util","CmsSigner","GenericDatasource","instanceSettings","$q","backendSrv","templateSrv","type","datasourceId","id","aliyunUserId","jsonData","userId","basePath","url","name","q","util","headers","cmsVersion","ecsVersion","ecsBasePath","rdsVersion","rdsBasePath","cacheMeta","Map","options","requests","result","targets","forEach","target","project","metric","ycol","xcol","describe","exists","resolve","period","group","dimensions","dimensions_variables","dimension","push","ycol_variables","y_col","indexOf","length","dimensionAcsJson","dimensionAcsObj","groupId","toString","replace","JSON","stringify","i","includes","dimension_i","substring","target_keys","resource","isEmpty","queryMetricMeta","then","response","Dimensions","target_key_arr","split","value","queryConcat","parseInt","range","from","_d","getTime","to","request","doNextToken","resResult","dataGroupByKeys","dataMap","key","map","ycolTarget","dataPoints","dataPoint","valueObj","datapoints","concat","parse","Promise","all","p","catch","e","data","list","keys","tmpMap","key_obj","key_target","j","value_arr","has","get","set","ms","setTimeout","cursor","count","path","param","method","query","buildRealUrl","d","defer","promise","wait","datasourceRequest","status","Code","angular","fromJson","Datapoints","nextToken","Cursor","Success","message","title","namespacesQuery","match","filter","templateToStr","getProject","namespaces","namespace","text","metricsQuery","getMetrics","metrics","tagFilterQuery","regionId","tagType","tagKey","tagKeyFilter","tagKeyArry","tagKeyInd","tagsFilter","toUpperCase","tagsList","arrayToMap","dimensionsQuery","instanceId","instanceId_array","strToArray","filter_array","getDimensions","is_instanceId_bool","is_filter_bool","instanceId_result","tagQuery","resourceId","resourceId_array","tag","tag_array","listTagResources","Resources","Resource","Namespace","error","console","log","MetricName","Periods","splice","statistics","Statistics","groupInfo","GroupId","groupName","GroupName","endTime","Date","startTime","dimensionData","datapoint","datapointInfo","index","rand","Math","floor","random","response_meta","data_meta","reqUrl","realUrl","buildECSRealUrl","tags","Tags","Tag","TagKey","TagValue","buildRDSRealUrl","Items","TagInfos","resourceType","v","tag_key_array","tag_value_array","t","t_split","tagList","rep","distinct_result","tagResource","TagResources","TagResource","ResourceId","NextToken","nextList","obj","re","RegExp","test"],"mappings":"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","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\nimport { Util } from \"./util.js\";\nimport { CmsSigner } from \"./signer.js\";\n\nexport class GenericDatasource {\n  constructor(instanceSettings, $q, backendSrv, templateSrv) {\n\tthis.type = instanceSettings.type;\n\tthis.datasourceId = instanceSettings.id;\n\tthis.aliyunUserId = instanceSettings.jsonData.userId;\n    this.basePath = instanceSettings.url;\n    this.name = instanceSettings.name;\n    this.jsonData = instanceSettings.jsonData;\n    this.q = $q;\n    this.backendSrv = backendSrv;\n    this.templateSrv = templateSrv;\n    this.util = new Util(templateSrv);\n    this.headers = { \"Content-Type\": \"application/json\" };\n    this.cmsVersion = \"2018-03-08\";\n    this.ecsVersion = \"2014-05-26\";\n    this.ecsBasePath = \"https://ecs.aliyuncs.com\";\n    this.rdsVersion = \"2014-08-15\";\n    this.rdsBasePath = \"https://rds.aliyuncs.com\";\n    this.cacheMeta = new Map();\n  }\n\n  query(options) {\n    var requests = [];\n    var result = [];\n    options.targets.forEach((target) => {\n      //非空参数判空处理\n      if (!target.project || !target.metric || !target.ycol || !target.xcol) {\n        return;\n      }\n      //默认数据\n      var ycol = target.ycol;\n      var xcol = target.xcol;\n      var describe = !target.describe ? target.describe : target.describe + \".\";\n      //处理模版\n      var project = this.util.exists(target.project) ? this.util.resolve(target.project, {}) : target.project;\n      var metric = this.util.exists(target.metric) ? this.util.resolve(target.metric, {}) : target.metric;\n      var period = this.util.exists(target.period) ? this.util.resolve(target.period, {}) : target.period;\n      var group = this.util.exists(target.group) ? this.util.resolve(target.group, {}) : target.group;\n      //处理数组模版\n      var dimensions = \"\";\n\n      var dimensions_variables = [];\n\n      target.dimensions.forEach((dimension) => {\n        this.util.exists(dimension) ? dimensions_variables.push(this.util.resolve(dimension, {})) : dimensions_variables.push(dimension);\n      });\n      var ycol_variables = [];\n      ycol.forEach((y_col) => {\n        y_col.indexOf(\"$\") != -1 ? ycol_variables.push(this.util.resolve(y_col, {})) : ycol_variables.push(y_col);\n      });\n      ycol = ycol_variables.length > 0 ? ycol_variables : ycol;\n\n      //自定义监控(acs_custom)、日志监控(acs_logMonitor)处理,只取下标为0的数据\n      if (project.indexOf(\"acs_custom\") != -1 || project.indexOf(\"acs_logMonitor\") != -1) {\n        var dimensionAcsJson = target.dimensions[0];\n        var dimensionAcsObj = {\n          groupId: group.toString(),\n          dimension: dimensionAcsJson.replace(/\\&/gi, \"%26\").replace(/\\{/gi, \"%7B\").replace(/\\}/gi, \"%7D\"),\n        };\n        dimensions = JSON.stringify(dimensionAcsObj);\n      } else {\n        //正常数据\n        dimensions = \"\";\n        dimensions_variables.forEach((dimension, i) => {\n          if (typeof dimension == \"string\") {\n            dimension = dimension.includes(\"{\") ? dimension : \"{\" + dimension;\n            dimension = dimension.includes(\"}\") ? dimension : dimension + \"}\";\n            // dimension = dimension.includes(\"\\\\\") ? dimension.replace(\"\\\\/gi\", \"\\\\\\\\\") : dimension;\n            dimensions += dimension + \",\";\n          } else {\n            dimension.forEach((dimension_i) => {\n              dimension_i = dimension_i.includes(\"{\") ? dimension_i : \"{\" + dimension_i;\n              dimension_i = dimension_i.includes(\"}\") ? dimension_i : dimension_i + \"}\";\n              // dimension = dimension.includes(\"\\\\\") ? dimension.replace(\"\\\\/gi\", \"\\\\\\\\\") : dimension;\n\n              dimensions += dimension_i + \",\";\n            });\n          }\n        });\n        dimensions = dimensions.substring(0, dimensions.length - 1);\n        dimensions = \"[\" + dimensions + \"]\";\n        dimensions = dimensions.replace(/\\&/gi, \"%26\").replace(/\\{/gi, \"%7B\").replace(/\\}/gi, \"%7D\");\n      }\n      var target_keys = [];\n      var resource = \"\";\n      if(this.isEmpty(project) || this.isEmpty(metric) || this.isEmpty(xcol) || ycol.length == 0){\n        return;\n      }\n      this.queryMetricMeta(project, metric).then(response => {\n        resource = response;\n        if (resource.length == 0 || this.isEmpty(resource[0].Dimensions)) {\n          return;\n        }\n        var target_key_arr = resource[0].Dimensions.split(\",\");\n        target_key_arr.forEach(value =>{\n          if(target_key_arr.length == 1){\n            target_keys.push(value);\n          }else{\n            if(value != \"userId\"){\n              target_keys.push(value);\n            }\n          }\n        })\n      });\n      \n      //拼接url参数\n      var queryConcat = \"/?Action=QueryMetricList&Length=1000&Project=\" + project + \"&Metric=\" + metric + \"&Period=\" + period\n         + \"&Dimensions=\" + dimensions + \"&StartTime=\" + parseInt(options.range.from._d.getTime()) + \"&EndTime=\" + parseInt(options.range.to._d.getTime());\n\n      //定义Promise元数据、根据URL发起请求\n      var request = this.doNextToken(queryConcat, \"\", 0, \"list\").then((response) => {\n        var resResult = [];\n        this.dataGroupByKeys(response, target_keys).then(dataMap => {\n          dataMap.forEach((value, key) => {\n\n            ycol.map((ycolTarget) => {\n              var dataPoints = [];\n              \n              value.forEach(valueObj =>{\n                var dataPoint = [];\n                dataPoint.push(valueObj[ycolTarget], valueObj[xcol]);\n                  // 封装返回目标的第二层数组值\n                  dataPoints.push(dataPoint);\n                // 封装返回目标的第三层数组值\n              })\n\n              resResult.push({\n                target: describe + key + \".\" + ycolTarget,\n                datapoints: dataPoints,\n              });\n            });\n          });\n\n          result = result.concat(typeof resResult == \"string\" ? JSON.parse(resResult) : resResult);\n        });\n      });\n      requests.push(request);\n    });\n\n    // 统一单独处理返回值\n    return Promise.all(requests.map((p) => p.catch((e) => e))).then(() => {\n      return { data: result };\n    });\n  }\n\n  async dataGroupByKeys(list, keys) {\n    let tmpMap = new Map();\n    for(let i = 0; i < list.length; i++){\n      let dataPoint = list[i];\n      \n      let key_obj = {};\n      let key_target = dataPoint[keys[0]];\n      for(let j = 0; j < keys.length; j++){\n        let key = keys[j];\n        let value = dataPoint[key];\n        key_obj[key] = value;\n\n        if(j > 0){\n          key_target += \"_\" + value;\n        }\n      }\n      let value_arr = [];\n      if(tmpMap.has(key_target)){\n        value_arr = tmpMap.get(key_target);\n      }\n\n      value_arr.push(dataPoint);\n      tmpMap.set(key_target, value_arr);\n    }\n    return tmpMap;\n  }\n\n  wait(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms))\n  }\n\n  async doNextToken(queryConcat, cursor, count, type) {\n    var path = \"\";\n    if (this.isEmpty(cursor)) {\n      path = queryConcat;\n    } else {\n      path = queryConcat + \"&Cursor=\" + cursor;\n    }\n    var param = {\n      path: path,\n      method: \"GET\",\n    };\n    // 签名已拼接的待查询URL\n    var query = this.buildRealUrl(param);\n    if (_.isEmpty(query)) {\n      var d = this.q.defer();\n      d.resolve({ data: [] });\n      return d.promise;\n    }\n    if(\"list\" == type){\n      await this.wait(1000);\n    }else if(\"last\" == type){\n      await this.wait(100);\n    }\n    //定义Promise元数据、根据URL发起请求\n    return this.backendSrv.datasourceRequest({\n        url: query,\n        method: \"GET\",\n        headers: this.headers,\n      }).then((response) => {\n        var result = [];\n        if (response.status == \"200\" && response.data.Code == \"200\") {\n          result = angular.fromJson(response.data.Datapoints);\n          if(count > 20){\n            return result;\n          }\n          count++;\n          var nextToken = response.data.Cursor;\n          if (this.isEmpty(response.data.Cursor)) {\n            return result;\n          } else {\n            return this.doNextToken(queryConcat, nextToken, count, type).then((data) => {\n              return result.concat(data); \n            });\n          }\n        }\n        return result;\n      }).catch(() => {\n        return [];\n      });\n  }\n\n  // 测试连接数据源接口\n  testDatasource() {\n    var param = {\n      path: \"?Action=QueryMetricMeta&PageNumber=1&PageSize=1&Project=acs_ecs_dashboard\",\n      method: \"GET\",\n    };\n    return this.backendSrv.datasourceRequest({\n        url: this.buildRealUrl(param),\n        method: \"GET\",\n      }).then((response) => {\n        var data = response.data;\n        if (data.Code == \"200\" && data.Success == true) {\n          return {\n            status: \"success\",\n            message: \"Data source is working\",\n            title: \"Success\",\n          };\n        }else{\n\t\t\treturn {\n\t\t\t\tstatus: \"failure\",\n\t\t\t\tmessage: \"Data source is not working\",\n\t\t\t\ttitle: \"Failure\",\n\t\t\t  };\n\t\t}\n      });\n  }\n\n  annotationQuery(options) {}\n\n  metricFindQuery(options) {\n    var result = [];\n    //接受一个参数\n    var namespacesQuery = options.match(/^namespaces\\(([^\\)]+?)(,\\s?([^,]+?))?\\)/);\n    namespacesQuery =\n      namespacesQuery == null ? options.match(/^namespace\\(([^\\)]+?)(,\\s?([^,]+?))?\\)/) : namespacesQuery;\n    if (namespacesQuery != null) {\n      var filter = this.util.templateToStr(namespacesQuery[1]);\n      return this.getProject().then((namespaces) => {\n        result = namespaces;\n        if (!this.isEmpty(filter)) {\n          result = [];\n          namespaces.map((namespace) => {\n            if (namespace.text.includes(filter)) {\n              result.push(namespace);\n            }\n          });\n        }\n        return result;\n      });\n    }\n\n    //接受二个参数\n    var metricsQuery = options.match(/^metrics\\(([^,]+?),\\s?([^,]+?)\\)/);\n    metricsQuery =\n      metricsQuery == null ? options.match(/^metric\\(([^,]+?),\\s?([^,]+?)\\)/) : metricsQuery;\n    if (metricsQuery != null) {\n      var namespace = this.util.templateToStr(metricsQuery[1]);\n      var filter = this.util.templateToStr(metricsQuery[2]);\n\n      result = [];\n      return this.getMetrics(namespace).then((metrics) => {\n        result = metrics;\n        if (!this.isEmpty(filter)) {\n          result = [];\n          metrics.map((metric) => {\n            if (metric.text.includes(filter)) {\n              result.push(metric);\n            }\n          });\n        }\n        return result;\n      });\n    }\n\n    //接受四个参数，过滤Tag提供key、value选择\n    var tagFilterQuery = options.match(/^tagFilter\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)(,\\s?(.+))?\\)/);\n    tagFilterQuery =\n      tagFilterQuery == null ? options.match(/^tagsFilter\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)(,\\s?(.+))?\\)/) : tagFilterQuery;\n    if (tagFilterQuery != null) {\n      var type = this.util.templateToStr(tagFilterQuery[1]);\n      var regionId = this.util.templateToStr(tagFilterQuery[2]);\n      var tagType = this.isEmpty(tagFilterQuery[3]) ? \"\" : tagFilterQuery[3];\n      var tagKey = this.isEmpty(tagFilterQuery[4]) ? \"\" : tagFilterQuery[4];\n      var path = \"/?Action=DescribeTags&PageNumber=1&PageSize=100&RegionId=\" + regionId;\n      var tagKeyFilter = [];\n      if(tagKey){\n        path = \"/?Action=DescribeTags&PageNumber=1&PageSize=100&RegionId=\" + regionId + \"&Tag.1.Key=\" + tagKey;\n        if(tagKey.indexOf(\"&Tag.2.Key=\") != -1){\n          var tagKeyArry = tagKey.split(\"&\");\n          tagKeyArry.forEach(tagKeyInd => {\n            tagKeyFilter.push(tagKeyInd.substring(tagKeyInd.indexOf(\"Key=\") == -1 ? 0 : tagKeyInd.indexOf(\"Key=\") + 4));\n          })\n        }else{\n          tagKeyFilter.push(tagKey);\n        }\n\n        if(tagKey.indexOf(\"Tag.1.Key=\") != -1){\n          path = \"/?Action=DescribeTags&PageNumber=1&PageSize=100&RegionId=\" + regionId + \"&\" + tagKey;\n        }\n        if(tagKey.indexOf(\"PageNumber=\") != -1){\n          path = \"/?Action=DescribeTags&PageSize=100&RegionId=\" + regionId + \"&\" + tagKey;\n        }\n        if(tagKey.indexOf(\"&\") == 0){\n          path = \"/?Action=DescribeTags&PageSize=100&RegionId=\" + regionId + tagKey;\n        }\n      }\n      var nextToken = \"\";\n      result = [];\n      return this.tagsFilter(type.toUpperCase(), nextToken, path, tagType, tagKeyFilter).then((tagsList) => {\n        return this.util.arrayToMap(tagsList);\n      });\n    }\n\n    //接受四个参数,暂不支持数组，提供dimensions选择\n    var dimensionsQuery = options.match(/^dimension\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)(,\\s?(.+))?\\)/);\n    dimensionsQuery =\n      dimensionsQuery == null ? options.match(/^dimensions\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)(,\\s?(.+))?\\)/) : dimensionsQuery;\n    if (dimensionsQuery != null) {\n      var namespace = this.util.templateToStr(dimensionsQuery[1]);\n      var metric = this.util.templateToStr(dimensionsQuery[2]);\n\n      var instanceId = dimensionsQuery[3];\n      var instanceId_array = this.util.exists(instanceId) ? this.util.resolve(instanceId, {}) : [];\n      if (instanceId_array.length == 0) {\n        if (this.isEmpty(instanceId)) {\n          instanceId_array = [];\n        } else {\n          instanceId_array = this.util.strToArray(instanceId);\n        }\n      }\n      var filter = dimensionsQuery[4];\n      var filter_array = this.util.exists(filter) ? this.util.resolve(filter, {}) : [];\n      if (filter_array.length == 0) {\n        if (this.isEmpty(filter)) {\n          filter_array = [];\n        } else {\n          filter_array = this.util.strToArray(filter);\n        }\n      }\n      result = [];\n      return this.getDimensions(namespace, metric, \"\", \"\", []).then(\n        (dimensions) => {\n          var is_instanceId_bool = this.isEmpty(instanceId);\n          var is_filter_bool = this.isEmpty(filter);\n          if (is_instanceId_bool) {\n            result = dimensions;\n          } else {\n            var instanceId_result = [];\n            dimensions.map((dimension) => {\n              instanceId_array.forEach((i) => {\n                if (dimension.text.includes(i)) {\n                  instanceId_result.push(dimension);\n                }\n              });\n            });\n            if (is_filter_bool) {\n              result = instanceId_result;\n            } else {\n              instanceId_result.map((dimension) => {\n                filter_array.forEach((i) => {\n                  if (dimension.text.includes(i)) {\n                    result.push(dimension);\n                  }\n                });\n              });\n            }\n          }\n          return result;\n        }\n      );\n    }\n\n    //接受5个参数,暂不支持数组，提供tag选择\n    var tagQuery = options.match(/^tag\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)(,\\s?(.+))?\\)/);\n    tagQuery =\n      tagQuery == null ? options.match(/^tags\\(([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?),\\s?([^,]+?)(,\\s?(.+))?\\)/) : tagQuery;\n    if (tagQuery != null) {\n      var resourceId = tagQuery[4];\n      var resourceId_array = this.util.exists(resourceId) ? this.util.resolve(resourceId, {}) : [];\n      if (resourceId_array.length == 0) {\n        if (this.isEmpty(resourceId)) {\n          resourceId_array = [];\n        } else {\n          resourceId_array = [];\n          resourceId_array = this.util.strToArray(resourceId);\n        }\n      }\n      var tag = tagQuery[5];\n      var tag_array = this.util.exists(tag) ? this.util.resolve(tag, {}) : [];\n      if (tag_array.length == 0) {\n        if (this.isEmpty(tag)) {\n          tag_array = [];\n        } else {\n          tag_array = [];\n          tag_array = this.util.strToArray(tag);\n        }\n      }\n      return this.listTagResources(\n        tagQuery[1].toUpperCase(),\n        tagQuery[2],\n        tagQuery[3],\n        resourceId_array,\n        tag_array\n      );\n    }\n    return [];\n  }\n\n  //返回所有的Project,QueryProjectMeta的API无自定义监控project、日志监控project，已拼接\n  getProject() {\n    var param = {\n      path: \"?Action=QueryProjectMeta&PageNumber=1&PageSize=2000\",\n      method: \"GET\",\n    };\n    return this.backendSrv\n      .datasourceRequest({\n        url: this.buildRealUrl(param),\n        method: \"GET\",\n      })\n      .then((response) => {\n        var result = [];\n        var data = response.data;\n        if (data.Code == \"200\" && data.Success == true) {\n          data.Resources.Resource.map((resource) => {\n            if (!this.isEmpty(resource.Namespace)) {\n              result.push(resource.Namespace);\n            }\n          });\n\t\t}\n        //增加自定义监控、日志监控选项\n\t\tresult.push(\"acs_logMonitor_\" + this.aliyunUserId);\n\t\tresult.push(\"acs_customMetric_\" + this.aliyunUserId);\n\t\treturn this.util.arrayToMap(result);\n      })\n      .catch(function (error) {\n        console.log(error);\n        return;\n      });\n  }\n\n  //根据Project返回对应的所有的Metrics,无自定义监控、日志监控project对应的Metrics\n  getMetrics(project) {\n    var param = {\n      path:\n        \"?Action=QueryMetricMeta&PageNumber=1&PageSize=2000&Project=\" +\n        project,\n      method: \"GET\",\n    };\n    return this.backendSrv\n      .datasourceRequest({\n        url: this.buildRealUrl(param),\n        method: \"GET\",\n      })\n      .then((response) => {\n        var data = response.data;\n        if (data.Code == \"200\" && data.Success == true) {\n          var result = [];\n          data.Resources.Resource.map((resource) => {\n            if (!this.isEmpty(resource.MetricName)) {\n              result.push(resource.MetricName);\n            }\n          });\n          return this.util.arrayToMap(result);\n        }\n      })\n      .catch(function (error) {\n        console.log(error);\n        return;\n      });\n  }\n\n  //根据Project及Metrics返回对应的所有的Period,无自定义监控、日志监控project对应的Period\n  getPeriod(project, metric) {\n    var param = {\n      path: \"?Action=QueryMetricMeta&PageNumber=1&PageSize=1&Project=\" + project + \"&Metric=\" + metric,\n      method: \"GET\",\n    };\n    return this.backendSrv.datasourceRequest({\n        url: this.buildRealUrl(param),\n        method: \"GET\",\n      }).then((response) => {\n        var data = response.data;\n        if (data.Code == \"200\" && data.Success == true) {\n          var period = [];\n          var resource = data.Resources.Resource;\n          if (resource.length > 0 && !this.isEmpty(resource[0].Periods)) {\n            period = resource[0].Periods.split(\",\");\n            period.splice(0, 0, \"auto\");\n          }\n          return this.util.arrayToMap(period);\n        }\n      }).catch(function (error) {\n        console.log(error);\n        return;\n      });\n  }\n\n  //根据Project及Metrics返回对应的所有的Statistics,未去除已选项,无自定义监控、日志监控project对应的Period\n  getStatistics(project, metric) {\n    var param = {\n      path: \"?Action=QueryMetricMeta&PageNumber=1&PageSize=1&Project=\" + project + \"&Metric=\" + metric,\n      method: \"GET\",\n    };\n    return this.backendSrv.datasourceRequest({\n        url: this.buildRealUrl(param),\n        method: \"GET\",\n      }).then((response) => {\n        var data = response.data;\n        if (data.Code == \"200\" && data.Success == true) {\n          var statistics = [];\n          var resource = data.Resources.Resource;\n          if (resource.length > 0 && !this.isEmpty(resource[0].Statistics)) {\n            statistics = resource[0].Statistics.split(\",\");\n          }\n          return this.util.arrayToMap(statistics);\n        }\n      }).catch(function (error) {\n        console.log(error);\n        return;\n      });\n  }\n\n  //返回所有的Groups,自定义监控、日志使用\n  getGroups() {\n    var param = {\n      path: \"?Action=ListMyGroups&PageNumber=1&PageSize=9000\",\n      method: \"GET\",\n    };\n    return this.backendSrv.datasourceRequest({\n        url: this.buildRealUrl(param),\n        method: \"GET\",\n      }).then((response) => {\n        var data = response.data;\n        if (data.Code == \"200\" && data.Success == true) {\n          var result = [];\n          var resource = data.Resources.Resource;\n          var i = resource.length;\n          while (i--) {\n            var group = resource[i];\n            var groupInfo = [];\n            var groupId = group.GroupId;\n            var groupName = group.GroupName;\n            if (this.isEmpty(groupId) || this.isEmpty(groupName)) {\n              continue;\n            }\n            groupInfo.push(groupId, groupName + \" / \" + groupId);\n            result.push(groupInfo);\n          }\n          return _.map(result, (d, i) => {\n            return { text: d[1], value: d[0] };\n          });\n        }\n      })\n      .catch(function (error) {\n        console.log(error);\n        return;\n      });\n  }\n\n  getDimensions(project, metric, period, dimensions, resource) {\n    if (project.indexOf(\"acs_customMetric\") != -1 || project.indexOf(\"acs_logMonitor\") != -1) {\n      return;\n    }\n    var endTime = new Date().getTime();\n    var startTime = endTime - 15 * 60 * 1000;\n    // TODO\n    var queryConcat = \"?Action=QueryMetricLast&Period=\" + period + \"&Project=\" + project + \"&Metric=\" + metric + \"&StartTime=\" + startTime + \"&EndTime=\" + endTime;\n    return this.doNextToken(queryConcat, \"\", 0, \"last\").then((data) => {\n        if (data.length == 0) {\n          return[];\n        }\n        // 构建可选参数dimensions\n        if(!this.isEmpty(resource)){\n          return this.dimensionData(data, resource, dimensions);\n        }else{\n          return this.queryMetricMeta(project, metric).then(response => {\n            resource = response;\n            if (this.isEmpty(resource) || this.isEmpty(resource[0].Dimensions)) {\n              return[];\n            }\n            return this.dimensionData(data, resource, dimensions);\n          });\n        }\n      }).catch(function (error) {\n        console.log(error);\n        return[];\n      });\n  }\n\n  async dimensionData(data, resource, dimensions){\n    var result = [];\n    var dimension = resource[0].Dimensions.split(\",\");\n\n    // var datapoints = JSON.parse(data.Datapoints);\n    data.map((datapoint) => {\n      var datapointInfo = '{\"';\n      dimension.forEach(function (value, index) {\n        value = value.replace(/\"/g, \"\");\n        if (value != \"userId\" || (value == \"userId\" && dimension.length == 1)) {\n          if (datapoint[value].indexOf(\":\\\\\") != -1) {\n            datapointInfo += value + '\":\"' + datapoint[value] + '\\\\\"';\n          } else {\n            datapointInfo += value + '\":\"' + datapoint[value] + '\"';\n          }\n          if (index == dimension.length - 1) {\n            datapointInfo += \"}\";\n          } else {\n            datapointInfo += ',\"';\n          }\n        }\n      });\n      //去重\n      if (result.length == 0) {\n        if (dimensions.length == 0) {\n          result.push(datapointInfo);\n        } else if (dimensions.length > 0 && !dimensions.includes(datapointInfo)) {\n          result.push(datapointInfo);\n        }\n      } else if (result.length > 0 && !result.includes(datapointInfo)) {\n        if (dimensions.length == 0) {\n          result.push(datapointInfo);\n        } else if (dimensions.length > 0 && !dimensions.includes(datapointInfo)) {\n          result.push(datapointInfo);\n        }\n      }\n    });\n    return this.util.arrayToMap(result);  \n  }\n\n  async queryMetricMeta(project, metric){\n    let rand = Math.floor(Math.random() * 4) + 5;\n    await this.wait(100 * rand);\n    \n    let resource = this.cacheMeta.get(project + \"_\" + metric);\n    if(this.isEmpty(resource)){\n      var param = {\n        path: \"?Action=QueryMetricMeta&PageNumber=1&PageSize=1&Project=\" + project + \"&Metric=\" + metric,\n        method: \"GET\",\n      };\n      return this.backendSrv.datasourceRequest({\n        url: this.buildRealUrl(param),\n        method: \"GET\",\n      }).then((response_meta) => {\n        var data_meta = response_meta.data;\n        if (data_meta.Code == \"200\" && data_meta.Success == true) {\n          resource = data_meta.Resources.Resource;\n          this.cacheMeta.set(project + \"_\" + metric, resource);\n          return resource;\n        }\n      });\n    }else{\n      return resource;\n    }\n  }\n\n  // 暂时无翻页功能,无nextToken字段返回\n  tagsFilter(type, nextToken, path, tagType, tagKeyFilter) {\n    var reqUrl = path;\n    if (!this.isEmpty(nextToken)) {\n      reqUrl += \"&NextToken=\" + nextToken;\n    }\n    var param = {\n      path: reqUrl,\n      method: \"GET\",\n    };\n    var realUrl = \"\";\n    if (\"ECS\" == type) {\n      realUrl = this.buildECSRealUrl(param);\n      return this.backendSrv.datasourceRequest({\n          url: realUrl,\n          method: \"GET\",\n        }).then((response) => {\n          var result = [];\n          var data = response.data;\n          var tags = data.Tags.Tag;\n          if (tags.length > 0) {\n            tags.forEach((tag) => {\n              if (\"key\" == tagType) {\n                if (!result.includes(tag.TagKey)) {\n                  result.push(tag.TagKey);\n                }\n              } else if (\"value\" == tagType) {\n                if (tagKeyFilter.includes(tag.TagKey) || tagKeyFilter.length == 0) {\n                  var value = tag.TagKey + \":/:\" + tag.TagValue;\n                  if (!result.includes(value)) {\n                    result.push(value);\n                  }\n                }\n              }\n            });\n          }\n          return result;\n        });\n    } else if (\"RDS\" == type) {\n      realUrl = this.buildRDSRealUrl(param);\n      return this.backendSrv\n        .datasourceRequest({\n          url: realUrl,\n          method: \"GET\",\n        })\n        .then((response) => {\n          var result = [];\n          var data = response.data;\n          var tags = data.Items.TagInfos;\n          if (tags.length > 0) {\n            tags.forEach((tag) => {\n              if (\"key\" == tagType) {\n                if (!result.includes(tag.TagKey)) {\n                  result.push(tag.TagKey);\n                }\n              } else if (\"value\" == tagType) {\n                if (tagKeyFilter.includes(tag.TagKey) || tagKeyFilter.length == 0) {\n                  var value = tag.TagKey + \":/:\" + tag.TagValue;\n                  if (!result.includes(value)) {\n                    result.push(value);\n                  }\n                }\n              }\n            });\n          }\n          return result;\n        });\n    }\n  }\n\n  listTagResources(type, regionId, resourceType, resourceId, tag) {\n    type = this.isEmpty(type) ? \"ECS\" : type;\n    regionId = this.isEmpty(regionId) ? \"cn-hangzhou\" : regionId;\n    if (\"ECS\" == type) {\n      resourceType = this.isEmpty(resourceType) ? \"instance\" : resourceType;\n    } else if (\"RDS\" == type) {\n      resourceType = this.isEmpty(resourceType) ? \"INSTANCE\" : resourceType;\n    }\n    var path = \"/?Action=ListTagResources&RegionId=\" + regionId + \"&ResourceType=\" + resourceType;\n    for (var i = 0; i < resourceId.length; i++) {\n      if (50 > i) {\n        var v = resourceId[i];\n        if (!this.isEmpty(v)) {\n          path += \"&ResourceId.\" + (parseInt(i) + 1).toString() + \"=\" + v;\n        }\n      }\n    }\n    var tag_key_array = [];\n    var tag_value_array = [];\n    tag.forEach((t) => {\n      if (!this.isEmpty(t)) {\n        if (t.indexOf(\":/:\") != -1) {\n          var t_split = t.split(\":/:\");\n          if (!tag_key_array.includes(t_split[0])) {\n            tag_key_array.push(t_split[0]);\n          }\n          if (!tag_value_array.includes(t_split[1])) {\n            tag_value_array.push(t_split[1]);\n          }\n        }\n      }\n    });\n    if (tag_key_array.length > 0) {\n      for (var i = 0; i < tag_key_array.length; i++) {\n        var key = tag_key_array[i];\n        path += \"&Tag.\" + (parseInt(i) + 1).toString() + \".Key=\" + key;\n      }\n    } else if (tag_key_array.length == 0 && tag.length > 0) {\n      for (var i = 0; i < tag.length; i++) {\n        var key = tag[i];\n        path += \"&Tag.\" + (parseInt(i) + 1).toString() + \".Key=\" + key;\n      }\n    }\n    var nextToken = \"\";\n    return this.tagList(type, nextToken, path, tag_value_array).then((rep) => {\n      var distinct_result = [];\n      rep.forEach((instanceId) => {\n        if (!distinct_result.includes(instanceId)) {\n          distinct_result.push(instanceId);\n        }\n      });\n      return this.util.arrayToMap(distinct_result);\n    });\n  }\n  // 处理nextToken问题\n  tagList(type, nextToken, path, tag_value_array) {\n    var reqUrl = path;\n    if (!this.isEmpty(nextToken)) {\n      reqUrl += \"&NextToken=\" + nextToken;\n    }\n    var param = {\n      path: reqUrl,\n      method: \"GET\",\n    };\n    var realUrl = \"\";\n    if (\"ECS\" == type) {\n      realUrl = this.buildECSRealUrl(param);\n    } else if (\"RDS\" == type) {\n      realUrl = this.buildRDSRealUrl(param);\n    }\n    return this.backendSrv.datasourceRequest({\n        url: realUrl,\n        method: \"GET\",\n      }).then((response) => {\n        var result = [];\n        var data = response.data;\n        var tagResource = data.TagResources.TagResource;\n        if (tagResource.length > 0) {\n          tagResource.forEach((resource) => {\n            if (tag_value_array.length > 0) {\n              if (tag_value_array.includes(resource.TagValue)) {\n                result.push(resource.ResourceId);\n              }\n            } else {\n              result.push(resource.ResourceId);\n            }\n          });\n        }\n        if (this.isEmpty(data.NextToken)) {\n          return result;\n        } else {\n          return this.tagList(type, data.NextToken, path, tag_value_array).then(\n            (nextList) => {\n              return result.concat(nextList);\n            }\n          );\n        }\n      });\n  }\n\n  // 根据云监控API文档处理URL签名,做封装调用接口用\n  buildRealUrl(param) {\n    return \"/api/datasources/\"+this.datasourceId+\"/resources/proxy_aliyun_cms_pop\" +  param.path;\n  }\n\n  // 根据ECS API文档处理URL签名,做封装调用接口用\n  buildECSRealUrl(param) {\n\treturn \"/api/datasources/\"+this.datasourceId+\"/resources/proxy_aliyun_ecs_pop\" +  param.path;\n  }\n\n  // 根据RDS API文档处理URL签名,做封装调用接口用\n  buildRDSRealUrl(param) {\n\treturn \"/api/datasources/\"+this.datasourceId+\"/resources/proxy_aliyun_rds_pop\" +  param.path;\n  }\n\n  // 判断对象是否为空对象 true 空\n  isEmpty(obj) {\n    var re = new RegExp(\"^[ ]+$\");\n    if (!obj || obj == \"null\" || obj == null || obj == \" \" || obj == \"\" || obj == '\"\"' || re.test(obj) || typeof obj == \"undefined\") {\n      return true;\n    } // 为空\n    return false; // 不为空\n  }\n}\n"]}